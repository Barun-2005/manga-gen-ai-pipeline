# MangaGen Repository Audit Summary
Date: 2025-12-12

## 1. What Was Found

### Repository Overview
- 25 subdirectories, 28 root-level files
- ~18 development phases evident from versioned scripts
- Core pipeline: LLM (OpenRouter) → ComfyUI → PDF compilation
- Extensive but unstructured test scripts

### Key Modules
- `llm/`: Story generation via OpenRouter/DeepSeek (not Gemini)
- `image_gen/`: ComfyUI client for SD1.5 models
- `core/`: Dialogue placement (1244 lines!), panel generation, config management
- `scripts/`: PDF compilation, scene generation, various test runners
- `assets/`: Workflows (7 JSON), prompts (3 files), negatives (2 files)

### Technical Stack
- LLM: OpenRouter API with DeepSeek R1 model
- Image: ComfyUI + anything-v4.5-pruned.safetensors (SD1.5)
- PDF: ReportLab with 2x2 grid layout
- Validation: OpenCV face detection, MediaPipe pose

## 2. What Is Being Kept (REUSE)

### Core Components (high value)
1. `core/dialogue_placer.py` - Production-ready bubble placement
2. `scripts/compile_pdf.py` - ReportLab PDF compilation
3. `llm/prompt_templates.py` - Act/scene/dialogue templates
4. `pipeline/utils.py` - Face/blur/pose detection utilities

### Assets
5. `assets/prompts/*.txt` - Quality manga prompt examples
6. `assets/negatives/*.txt` - Negative prompt templates
7. `config/settings.yaml` - Comprehensive config structure

### Test Resources
8. `tests/sample_prompts.txt` - Example test prompts

## 3. What Is Being Archived/Removed

### Moving to /archive/legacy/
- All phase-specific scripts (phase*.py)
- Root-level test scripts (test_*.py)
- `contest_package/` directory (old version)
- `pipeline_v2/` directory (experimental)
- Phase markdown files (PHASE18_SUMMARY.md, etc.)

### Keeping but Not Using in MVP
- `ComfyUI-master/` - Full installation (Kaggle uses Diffusers)
- `production/` - Flask web interface

## 4. Next Steps (Time Estimates)

### Immediate (before any code changes)
1. Commit audit files (5 min)
2. Create legacy archive directory (10 min)
3. Tag archive: archive/pre-mvp-20251212 (2 min)
4. Create mvp/kaggle-flux branch (2 min)

### MVP Implementation (estimated 2-4 hours each)
1. `generate_scene_json.py` - Gemini integration, Pydantic schema
2. `train_lora.py` - Minimal PEFT/LoRA script
3. `generate_panels.py` - Diffusers/Flux generation
4. `place_bubbles.py` - Adapt from dialogue_placer.py
5. `compose_page.py` - Adapt from compile_pdf.py

### Integration (estimated 1-2 hours)
6. `kaggle_run.ipynb` - End-to-end notebook
7. `run_locally.sh` - Local dev wrapper
8. Update README.md

### Testing (estimated 1 hour)
9. JSON schema validation test
10. Smoke test with sample prompt
11. Create examples/ directory

## 5. Decisions Requiring User Input

1. **Flux vs SD1.5**: Which to prioritize? (Flux preferred but harder)
2. **LoRA Training**: Skip for initial MVP? (Use IP-Adapter instead?)
3. **Kaggle GPU Hours**: Allocate testing quota?
4. **Character References**: Use existing images or generate new?

---

Full audit details: /archive/repo_audit.md
